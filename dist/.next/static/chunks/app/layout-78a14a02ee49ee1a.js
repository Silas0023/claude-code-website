(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{13673:()=>{},33944:e=>{e.exports={style:{fontFamily:"'Geist Mono', 'Geist Mono Fallback'",fontStyle:"normal"},className:"__className_9a8899",variable:"__variable_9a8899"}},60080:(e,t,a)=>{Promise.resolve().then(a.t.bind(a,96168,23)),Promise.resolve().then(a.t.bind(a,33944,23)),Promise.resolve().then(a.t.bind(a,13673,23)),Promise.resolve().then(a.bind(a,65380))},65380:(e,t,a)=>{"use strict";a.d(t,{A:()=>c,AuthProvider:()=>i});var r=a(95155),o=a(12115),s=a(90960);let n=(0,o.createContext)(void 0);function i(e){let{children:t}=e,[a,i]=(0,o.useState)(null),[c,l]=(0,o.useState)(!0);(0,o.useEffect)(()=>{let e=localStorage.getItem("user");if(e)try{let t=JSON.parse(e);i(t)}catch(e){console.error("Error parsing stored user:",e),localStorage.removeItem("user")}l(!1)},[]);let d=async(e,t)=>new Promise((a,r)=>{setTimeout(()=>{if(e&&t){let t={id:"1",email:e,name:e.split("@")[0],avatar:"https://api.dicebear.com/7.x/avataaars/svg?seed=".concat(e)};i(t),localStorage.setItem("user",JSON.stringify(t)),a()}else r(Error("Invalid credentials"))},1e3)}),u=async(e,t)=>{try{let a=await s.K.login(e,t);if(200===a.code||0===a.code){let t={id:a.data.userInfo.id.toString(),email:a.data.userInfo.phone,name:a.data.userInfo.nickname||e.replace(/(\d{3})\d{4}(\d{4})/,"$1****$2"),avatar:a.data.userInfo.avatar||"https://api.dicebear.com/7.x/avataaars/svg?seed=".concat(e),phone:a.data.userInfo.phone,token:a.data.token,userInfo:a.data.userInfo};try{let e=await s.K.getUserStats(a.data.userInfo.id.toString());(200===e.code||0===e.code)&&(t.userStats=e.data)}catch(e){console.warn("获取用户统计信息失败:",e)}i(t),localStorage.setItem("user",JSON.stringify(t)),localStorage.setItem("token",a.data.token)}else throw Error(a.message||"登录失败")}catch(e){throw Error(e.message||"网络错误，请重试")}},h=async e=>{try{let t=await s.K.sendVerificationCode(e);if(200===t.code||0===t.code)return;throw Error(t.message||"发送验证码失败")}catch(e){throw Error(e.message||"网络错误，请重试")}},p=async()=>{if(!(null==a?void 0:a.id))throw Error("用户未登录");try{let e=await s.K.getUserInfo(a.id);if(200===e.code||0===e.code){let t={...a,userInfo:e.data,name:e.data.nickname||a.name,avatar:e.data.avatar||a.avatar,phone:e.data.phone||a.phone};i(t),localStorage.setItem("user",JSON.stringify(t))}else throw Error(e.message||"获取用户信息失败")}catch(e){throw Error(e.message||"网络错误，请重试")}},m=async()=>{if(!(null==a?void 0:a.id))throw Error("用户未登录");try{let e=await s.K.getUserStats(a.id);if(200===e.code||0===e.code){let t={...a,userStats:e.data};i(t),localStorage.setItem("user",JSON.stringify(t))}else throw Error(e.message||"获取用户统计信息失败")}catch(e){throw Error(e.message||"网络错误，请重试")}},f=async()=>{if(!(null==a?void 0:a.id))throw Error("用户未登录");try{let[t,r]=await Promise.all([s.K.getUserInfo(a.id),s.K.getUserStats(a.id)]),o={...a};if(200===t.code||0===t.code){var e;o={...o,userInfo:{...t.data,planName:(null==(e=t.data.subscriptionConfig)?void 0:e.displayName)||"FREE"},name:t.data.nickname||a.name,avatar:t.data.avatar||a.avatar,phone:t.data.phone||a.phone}}(200===r.code||0===r.code)&&(o={...o,userStats:r.data}),i(o),localStorage.setItem("user",JSON.stringify(o))}catch(e){throw Error(e.message||"网络错误，请重试")}};return(0,r.jsx)(n.Provider,{value:{user:a,isLoading:c,login:d,loginWithPhone:u,sendVerificationCode:h,refreshUserInfo:p,refreshUserStats:m,refreshAllUserData:f,logout:()=>{i(null),localStorage.removeItem("user"),localStorage.removeItem("token")},checkAuth:()=>!!a,setServerUrl:e=>{s.K.setBaseUrl(e)},getServerUrl:()=>s.K.baseUrl||"http://127.0.0.1:8088"},children:t})}function c(){let e=(0,o.useContext)(n);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},90960:(e,t,a)=>{"use strict";a.d(t,{K:()=>o});class r{getBaseUrl(){return localStorage.getItem("api_base_url")||"https://ai01.zjczwl.cn"}setBaseUrl(e){this.baseUrl=e,localStorage.setItem("api_base_url",e)}getClientIp(){return"127.0.0.1"}async sendVerificationCode(e){let t=await fetch("".concat(this.baseUrl,"/api/claudeApi/sendCode?phone=").concat(e),{method:"GET",headers:{"Content-Type":"application/json"}});if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));return t.json()}async login(e,t){let a=await fetch("".concat(this.baseUrl,"/api/claudeApi/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phone:e,code:t,loginIp:this.getClientIp()})});if(!a.ok)throw Error("HTTP error! status: ".concat(a.status));return a.json()}async getSubscriptionPlans(){let e=await fetch("".concat(this.baseUrl,"/api/claudeApi/subscriptionPlans"),{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));return e.json()}async getUserInfo(e){let t="".concat(this.baseUrl,"/api/claudeApi/userInfo/").concat(e),a=await fetch(t,{method:"GET",headers:{"Content-Type":"application/json"}});if(!a.ok)throw Error("HTTP error! status: ".concat(a.status));return await a.json()}async getUserStats(e){let t=await fetch("".concat(this.baseUrl,"/api/claudeApi/userStats/").concat(e),{method:"GET",headers:{"Content-Type":"application/json"}});if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));return t.json()}async getUserModelStats(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"monthly",a=await fetch("".concat(this.baseUrl,"/api/claudeApi/userModelStats"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({apiId:e,period:t})});if(!a.ok)throw Error("HTTP error! status: ".concat(a.status));return a.json()}async createOrder(e,t,a){let r=await fetch("".concat(this.baseUrl,"/api/claudeApi/order/create"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({subscriptionConfigId:e,type:t,userId:a})});if(!r.ok)throw Error("HTTP error! status: ".concat(r.status));return r.json()}constructor(){this.baseUrl=this.getBaseUrl()}}let o=new r},96168:e=>{e.exports={style:{fontFamily:"'Geist', 'Geist Fallback'",fontStyle:"normal"},className:"__className_188709",variable:"__variable_188709"}}},e=>{e.O(0,[652,441,255,358],()=>e(e.s=60080)),_N_E=e.O()}]);